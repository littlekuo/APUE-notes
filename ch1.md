# UNIX 基础知识

## 体系结构
1.操作系统可视作为一种软件，它控制计算机硬件资源，提供程序运行环境，这种软件称之为内核。  
2.UNIX内核的接口称为系统调用。公用函数库构建在系统调用接口之上。应用程序既可以使用公用函数库，也可以使用系统调用。

## 文件与目录  
1.路径名：由斜线分隔的一个或者多个文件名组成的序列  
  * 以斜线开头的路径名称为绝对路径名
  * 否则称作相对路径名

  
2.每个进程都有一个工作目录，称作当前工作目录。所有的相对路径名都是从工作目录开始解释。
  * 可用chdir函数更改工作目录

## 输入输出
1.文件描述符：通常是一个小的非负整数，内核用以标识某个特定进程正在访问的文件。内核打开或者创建一个文件时，返回的都是文件描述符。  
2.每当运行一个新程序时，所有shell都为其打开3个文件描述符：标准输入，标准输出和标准错误。
3.不带缓冲的IO：例如open，read，write，lseek以及close等。

## 标准IO
1.标准IO函数为那些不带缓冲的I/O函数提供了一个带缓冲的接口。

## 进程
1.程序是存储在磁盘上的可执行文件，程序的运行实例称作进程。UNIX系统确保每个进程都有一个唯一的数字标识符，称作进程ID（总是一个非负整数）。  
2.有3个用于进程控制的主要函数：fork，exec和waitpid。
3.通常一个进程内只有一个线程，但是也可以创建多个线程。
  * 同一进程内的多个线程共享同一地址空间，文件描述符，栈以及其他进程相关属性。
  * 因为多线程能访问同一存储空间，所以各线程访问共享数据时需要采取措施来避免不一致性。
  * 线程也用ID标识，但是线程ID只有在它所属的进程内有意义。

## 出错处理
1.当 UNIX 系统函数出错时，通常会返回一个负值，同时整型变量 errno 通常被设置为具有特定信息的值。
  * 文件 <errno.h> 定义了 errno 以及赋予它的各种常量，这些常量以 E字符开头
  * 在多线程环境中，每个线程都有属于自己的局部 errno，以避免一个线程干扰另一个线程。

2.注意：
  * 如果没有出错，则errno的值不会被清除。因此只有在函数的返回值指明出错了时，检查errno才有意义
  * 任何函数都不会将errno的值清零，且在<errno.h>中定义的所有常量都不为0。

  
3.C标准定义了strerror/perror函数：用于处理错误信息
``` c++
#include<string.h>
char *strerror(int errnum);
#include<stdio.h>
void perror(const char* msg);
```
strerror: 将 errnum（通常就是 errno值）映射为一个出错消息字符串，并且返回此字符串的指针。  
perror: 基于 errno的当前值，在标准错误上产生一条出错消息，然后返回。这条出错消息先是 msg指向的字符串，后面是冒号，再是一个空格，后面是对应于errno值的出错消息，最后是一个换行符。  
  
4.出错恢复：可以将<errno.h>中定义的错误分成两类：
  * 致命性错误：此类错误无法恢复，只能打印出错信息
  * 非致命性错误：此类错误可以妥善处理。比如暂时性的资源短缺。

与资源相关的非致命性错误包括：EAGAIN、ENFILE、ENOBUFS、ENOLCK、ENOSPC、EWOULDBLOCK.其典型的处理方法是：延迟一段时间，然后重试。

## 用户标识
1.用户ID：标识各个不同的用户，用户ID为0的用户为根用户，其登录名为 root，它具有超级用户权限。  
2.组ID：用户所属的组的标识。  
3.附属组ID：一个用户可以属于多个组，这些组就是附属组。由附属组的ID来标识。

## 时间值
1.UNIX使用两种时间：
  * 日历时间：自UTC 1970年1月1日 00:00:00 以来经历过的秒数累计值。用 time_t数据类型来保存这种时间值。
  * 进程时间：也称CPU时间，用于度量进程使用的CPU资源。进程时间以时间滴答来计算，用clock_t数据类型保存这种时间值。  

  
2.当度量一个进程的执行时间时，UNIX系统为一个进程维护了3个进程时间值：
  * 时钟时间： 又称作墙上时钟时间，是进程运行的时间总量，其值与系统中同时运行的进程数有关。
  * 用户CPU时间：执行用户指令所用的时间量
  * 系统CPU时间：该进程执行内核程序所经历的时间。用户CPU时间和系统CPU时间之和称作 CPU 时间。

  
3.运行 shell 命令 time 可以获取进程的时钟时间、用户时间和系统时间。

![avatar](./imgs/ch1-time.png)












    
